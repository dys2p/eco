<p>{{.Tr "Pay with Monero (XMR) or Bitcoin (BTC). The full amount must be paid with a single transaction to the given address within 60 minutes. If your payment arrives too late, we have to confirm it manually. If in doubt, please contact us."}}</p>
<!-- open in new window, in case you didn't bookmark the purchase url -->
<form action="/payment/btcpay/create-invoice" method="post" target="_blank">
	<input type="hidden" name="default-language" value="{{.DefaultLanguage}}">
	<input type="hidden" name="reference" value="{{.Reference}}">
	<button type="submit" class="btn btn-success mb-3">{{.Tr "Pay using Monero or Bitcoin"}}</button>

	{{if .Status}}
		<div id="btcpay-status" class="mb-2"></div>
		<script>
			function updateBTCPayStatus() {
				fetch("/payment/btcpay/status")
				.then((response) => response.json())
				.then((data) => {
					let content = "";
					for(item of data) {
						content = content + `<span class="badge bg-${item.Synced ? 'success' : 'warning'} my-2">${item.Name}: ${item.Synced ? 'synced' : 'out of sync'}</span> `;
					}
					document.getElementById("btcpay-status").innerHTML = content;
				})
				.catch((error) => document.getElementById("btcpay-status").innerHTML = '<span class="badge bg-warning">Error loading sync status.</span>')
				.finally(() => {
					setTimeout(() => updateBTCPayStatus(), 100*1000); // 10 seconds from now
				});
			}
			updateBTCPayStatus();
		</script>
	{{end}}
</form>
